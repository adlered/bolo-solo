Util.htmlDecode=function(t){var e=document.createElement("div");return e.innerHTML=decodeURIComponent(t),e.innerText};var Admin=function(){this.register={},this.tools=["#page-list","#theme-list","#link-list","#preference","#user-list","#plugin-list","#others","#category-list","#usite","#tool-box"],this.adTools=["link-list","preference","theme-list","page-list","user-list","plugin-list","others","category-list","usite","tool-box"]};$.extend(Admin.prototype,{logout:function(){window.location.href=Label.servePath+"/logout"},toggleMenu:function(){"-240px"===$("#tabs").css("left")?($("#tabs").css("left",0),$(".tabs__bg").show()):($("#tabs").css("left","-240px"),$(".tabs__bg").hide())},clearTip:function(){$("#tipMsg").text(""),$("#loadMsg").text("")},setHashByPage:function(t){var e=window.location.hash.split("/");/^\d*$/.test(e[e.length-1])?e[e.length-1]=t:e.push(t),window.location.hash=e.join("/")},selectTab:function(t){window.location.hash="#"+t},analyseHash:function(){for(var t=window.location.hash,e=t.substr(1,t.length-1).split("/"),i={page:1,hashList:[]},a=0;a<e.length;a++)a===e.length-1&&/^\d+$/.test(e[a])?i.page=e[a]:i.hashList.push(e[a]);return i},setCurByHash:function(){$(window).scrollTop(0),$("#tipMsg").text("");var t=admin.analyseHash(),e=t.hashList[1],i=t.hashList[2];if(1===t.hashList.length&&(e=t.hashList[0]),""!==e){try{if(admin.editors.articleEditor.getContent){if("article"!==e&&admin.article.isConfirm&&""!==admin.editors.articleEditor.getContent().replace(/\s/g,"")&&admin.article.content!==admin.editors.articleEditor.getContent()&&!confirm(Label.editorLeaveLabel))return void(window.location.hash="#article/article");if("article"===e&&admin.article.isConfirm&&""!==admin.editors.articleEditor.getContent().replace(/\s/g,"")&&admin.article.content!==admin.editors.articleEditor.getContent())return}}catch(t){console.log(t)}"article"!==e&&admin.editors.articleEditor.setContent&&admin.article.clear(),admin.article.isConfirm=!0,$("#tabs").tabs("setCurrent",e),$("#loadMsg").text(Label.loadingLabel),1===$("#tabsPanel_"+e).length?""===$("#tabsPanel_"+e).html().replace(/\s/g,"")?$("#tabsPanel_"+e).load("admin-"+e+".do",(function(){"article"===e&&admin.article.status.id?admin.register[e].init.call(admin.register[e].obj,admin.article.getAndSet):admin.register[e].init.call(admin.register[e].obj,t.page),i&&$("#tab"+e.substring(0,1).toUpperCase()+e.substring(1)).tabs("setCurrent",i),admin.plugin.setCurByHash(t)})):("article"===e&&admin.article.status.id&&admin.article.getAndSet(),admin.register[e]&&admin.register[e].refresh&&admin.register[e].refresh.call(admin.register[e].obj,t.page),i&&$("#tab"+e.substring(0,1).toUpperCase()+e.substring(1)).tabs("setCurrent",i),admin.plugin.setCurByHash(t)):($("#tipMsg").text("Error: No tab! "+Label.reportIssueLabel),$("#loadMsg").text(""))}},init:function(){Util.killIE(),$("#loadMsg").text(Label.loadingLabel),$("#tabs").tabs(),setInterval((function(){""!==$("#tipMsg").text()&&setTimeout((function(){$("#tipMsg").text("")}),7e3)}),6e3),$("#loadMsg").text(""),window.onbeforeunload=function(t){if("#article/article"===window.location.hash)return t&&(t.returnValue=Label.editorLeaveLabel),Label.editorLeaveLabel},$(document).ajaxError((function(t,e,i,a){200!==e.status&&$("#tipMsg").text(e.status+": "+a)}))},collapseNav:function(t){$(t).next().slideToggle("normal",(function(){"none"!==this.style.display?($(t).find(".icon-chevron-down")[0].className="icon-chevron-up fn__right",$(t).addClass("tab-current")):($(t).find(".icon-chevron-up")[0].className="icon-chevron-down fn__right",$(t).removeClass("tab-current")),$("#tabs > ul").height("auto"),$("#tabs > ul").height($("#tabs > ul").height()+80)}))},inited:function(){if("adminRole"!==Label.userRole)for(var t=0;t<this.adTools.length;t++)$("#tabs").tabs("remove",this.adTools[t]);else for(var e=0;e<this.tools.length;e++)if("#"+window.location.hash.split("/")[1]===this.tools[e]){$("#tabToolsTitle").click();break}this.setCurByHash()}});var admin=new Admin;
admin.editors={};var SoloEditor=function(e){this.conf=e,this.init()};$.extend(SoloEditor.prototype,{init:function(){Label.emoji={};let e=JSON.parse('[{"doge":"https://file.fishpi.cn/vditor/3.8.13/dist/images/emoji/doge.png"},{"huaji":"https://file.fishpi.cn/vditor/3.8.13/dist/images/emoji/huaji.gif"},{"smile":"\ud83d\ude04"},{"laughing":"\ud83d\ude06"},{"smirk":"\ud83d\ude0f"},{"heart_eyes":"\ud83d\ude0d"},{"kissing_heart":"\ud83d\ude18"},{"flushed":"\ud83d\ude33"},{"grin":"\ud83d\ude01"},{"stuck_out_tongue_closed_eyes":"\ud83d\ude1d"},{"sleeping":"\ud83d\ude34"},{"anguished":"\ud83d\ude27"},{"open_mouth":"\ud83d\ude2e"},{"expressionless":"\ud83d\ude11"},{"unamused":"\ud83d\ude12"},{"sweat_smile":"\ud83d\ude05"},{"weary":"\ud83d\ude29"},{"sob":"\ud83d\ude2d"},{"joy":"\ud83d\ude02"},{"astonished":"\ud83d\ude32"},{"scream":"\ud83d\ude31"},{"tired_face":"\ud83d\ude2b"},{"rage":"\ud83d\ude21"},{"triumph":"\ud83d\ude24"},{"yum":"\ud83d\ude0b"},{"mask":"\ud83d\ude37"},{"sunglasses":"\ud83d\ude0e"},{"dizzy_face":"\ud83d\ude35"},{"imp":"\ud83d\udc7f"},{"smiling_imp":"\ud83d\ude08"},{"innocent":"\ud83d\ude07"},{"alien":"\ud83d\udc7d"},{"yellow_heart":"\ud83d\udc9b"},{"blue_heart":"\ud83d\udc99"},{"purple_heart":"\ud83d\udc9c"},{"green_heart":"\ud83d\udc9a"},{"broken_heart":"\ud83d\udc94"},{"anger":"\ud83d\udca2"},{"exclamation":"\u2757"},{"question":"\u2753"},{"zzz":"\ud83d\udca4"},{"notes":"\ud83c\udfb6"},{"poop":"\ud83d\udca9"},{"+1":"\ud83d\udc4d"},{"-1":"\ud83d\udc4e"},{"ok_hand":"\ud83d\udc4c"},{"punch":"\ud83d\udc4a"},{"v":"\u270c"},{"point_up":"\u261d"},{"point_down":"\ud83d\udc47"},{"pray":"\ud83d\ude4f"},{"clap":"\ud83d\udc4f"},{"muscle":"\ud83d\udcaa"},{"ok_woman":"\ud83d\ude46"},{"no_good":"\ud83d\ude45"},{"raising_hand":"\ud83d\ude4b"},{"massage":"\ud83d\udc86"},{"haircut":"\ud83d\udc87"},{"nail_care":"\ud83d\udc85"},{"see_no_evil":"\ud83d\ude48"},{"feet":"\ud83d\udc3e"},{"trollface":"https://file.fishpi.cn/vditor/3.8.13/dist/images/emoji/trollface.png"},{"snowman":"\u26c4"},{"zap":"\u26a1"},{"cat":"\ud83d\udc31"},{"dog":"\ud83d\udc36"},{"mouse":"\ud83d\udc2d"},{"hamster":"\ud83d\udc39"},{"rabbit":"\ud83d\udc30"},{"frog":"\ud83d\udc38"},{"koala":"\ud83d\udc28"},{"pig":"\ud83d\udc37"},{"monkey":"\ud83d\udc12"},{"racehorse":"\ud83d\udc0e"},{"camel":"\ud83d\udc2b"},{"sheep":"\ud83d\udc11"},{"elephant":"\ud83d\udc18"},{"panda_face":"\ud83d\udc3c"},{"snake":"\ud83d\udc0d"},{"hatched_chick":"\ud83d\udc25"},{"hatching_chick":"\ud83d\udc23"},{"turtle":"\ud83d\udc22"},{"bug":"\ud83d\udc1b"},{"honeybee":"\ud83d\udc1d"},{"beetle":"\ud83d\udc1e"},{"snail":"\ud83d\udc0c"},{"octopus":"\ud83d\udc19"},{"whale":"\ud83d\udc33"},{"dolphin":"\ud83d\udc2c"},{"dragon":"\ud83d\udc09"},{"goat":"\ud83d\udc10"},{"paw_prints":"\ud83d\udc3e"},{"tulip":"\ud83c\udf37"},{"four_leaf_clover":"\ud83c\udf40"},{"rose":"\ud83c\udf39"},{"mushroom":"\ud83c\udf44"},{"seedling":"\ud83c\udf31"},{"shell":"\ud83d\udc1a"},{"crescent_moon":"\ud83c\udf19"},{"partly_sunny":"\u26c5"},{"octocat":"https://file.fishpi.cn/vditor/3.8.13/dist/images/emoji/octocat.png"},{"jack_o_lantern":"\ud83c\udf83"},{"ghost":"\ud83d\udc7b"},{"santa":"\ud83c\udf85"},{"tada":"\ud83c\udf89"},{"camera":"\ud83d\udcf7"},{"loudspeaker":"\ud83d\udce2"},{"hourglass":"\u231b"},{"lock":"\ud83d\udd12"},{"bulb":"\ud83d\udca1"},{"hammer":"\ud83d\udd28"},{"moneybag":"\ud83d\udcb0"},{"smoking":"\ud83d\udeac"},{"bomb":"\ud83d\udca3"},{"gun":"\ud83d\udd2b"},{"hocho":"\ud83d\udd2a"},{"pill":"\ud83d\udc8a"},{"syringe":"\ud83d\udc89"},{"scissors":"\u2702"},{"swimmer":"\ud83c\udfca"},{"black_joker":"\ud83c\udccf"},{"coffee":"\u2615"},{"tea":"\ud83c\udf75"},{"sake":"\ud83c\udf76"},{"beer":"\ud83c\udf7a"},{"wine_glass":"\ud83c\udf77"},{"pizza":"\ud83c\udf55"},{"hamburger":"\ud83c\udf54"},{"poultry_leg":"\ud83c\udf57"},{"meat_on_bone":"\ud83c\udf56"},{"dango":"\ud83c\udf61"},{"doughnut":"\ud83c\udf69"},{"icecream":"\ud83c\udf66"},{"shaved_ice":"\ud83c\udf67"},{"cake":"\ud83c\udf70"},{"cookie":"\ud83c\udf6a"},{"lollipop":"\ud83c\udf6d"},{"apple":"\ud83c\udf4e"},{"green_apple":"\ud83c\udf4f"},{"tangerine":"\ud83c\udf4a"},{"lemon":"\ud83c\udf4b"},{"cherries":"\ud83c\udf52"},{"grapes":"\ud83c\udf47"},{"watermelon":"\ud83c\udf49"},{"strawberry":"\ud83c\udf53"},{"peach":"\ud83c\udf51"},{"banana":"\ud83c\udf4c"},{"pear":"\ud83c\udf50"},{"pineapple":"\ud83c\udf4d"},{"sweet_potato":"\ud83c\udf60"},{"eggplant":"\ud83c\udf46"},{"tomato":"\ud83c\udf45"}]');Array.isArray(e)&&e.forEach(e=>{const o=Object.keys(e)[0];Label.emoji[o]=e[o]});const o={outline:this.conf.outline||!1,mode:Label.editorMode,typewriterMode:this.conf.typewriterMode,cache:{enable:!0},tab:"\t",preview:{delay:500,mode:this.conf.previewMode,url:Label.servePath+"/console/markdown/2html",hljs:{enable:!Label.luteAvailable,style:Label.hljsStyle},parse:function(e){"none"!==e.style.display&&Util.parseMarkdown()}},upload:{max:107374182400,url:Label.uploadURL,token:Label.uploadToken,filename:function(e){return e.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g,"").replace(/[\?\\/:|<>\*\[\]\(\)\$%\{\}@~]/g,"").replace("/\\s/g","")}},height:this.conf.height,counter:{enable:!0,max:102400},resize:{enable:this.conf.resize},lang:Label.localeString,hint:{emojiTail:'<a href="https://'+Label.hacpaiDomain+'/emoji/index.html" target="_blank">\u5168\u90e8\u8868\u60c5</a>',emoji:Label.emoji},toolbarConfig:{pin:!0},toolbar:["emoji","headings","bold","link","|","list","ordered-list","check","outdent","indent","|","quote","code","insert-before","insert-after","|","upload","record","table","|","undo","redo","|","fullscreen","edit-mode",{name:"more",toolbar:["italic","strike","line","inline-code","both","code-theme","content-theme","export","outline","preview","devtools","info","help"]}],after:()=>{"function"==typeof this.conf.fun&&this.conf.fun()}};$(window).width()<768&&(o.toolbar=["emoji","link","upload","edit-mode",{name:"more",toolbar:["insert-after","fullscreen","preview","info","help"]}],o.resize.enable=!1,o.toolbarConfig.pin=!0),"undefined"==typeof Vditor?Util.loadVditor(()=>{this.editor=new Vditor(this.conf.id,o)}):this.editor=new Vditor(this.conf.id,o)},getContent:function(){return this.editor.getValue()},setContent:function(e){this.editor.setValue(e)},remove:function(){document.getElementById(this.editor.vditor.id).outerHTML=""}}),admin.editors.articleEditor={},admin.editors.abstractEditor={};
var TablePaginate=function(a){this.id=a,this.currentPage=1};$.extend(TablePaginate.prototype,{buildTable:function(a,t){var e={colModel:a,noDataTip:Label.noDataLabel};t||(e.expendRow={index:"expendRow"}),$("#"+this.id+"Table").table(e)},initPagination:function(){var a=this.id;$("#"+a+"Pagination").paginate({bind:function(a,t){t?$("#tipMsg").text(t):admin.setHashByPage(a)},currentPage:1,errorMessage:Label.inputErrorLabel,nextPageText:">",previousPageText:"<",goText:Label.gotoLabel,type:"custom",custom:[1],pageCount:1})},initCommentsDialog:function(){var a=this;$("#"+this.id+"Comments").dialog({modal:!0,hideFooter:!0,close:function(){return admin[a.id+"List"].getList(a.currentPage),!0}})},updateTablePagination:function(a,t,e){if((t=parseInt(t))>e.paginationPageCount&&t>1)return $("#tipMsg").text(Label.pageLabel+t+Label.notFoundLabel),void $("#loadMsg").text("");$("#"+this.id+"Table").table("update",{data:[{groupName:"all",groupData:a}]}),0===e.paginationPageCount&&(e.paginationPageCount=1),$("#"+this.id+"Pagination").paginate("update",{pageCount:e.paginationPageCount,currentPage:t,custom:e.paginationPageNums}),this.currentPage=t}});
admin.article={isConfirm:!0,status:{id:void 0,isArticle:void 0},content:"",get:function(t,e){this.status.id=t,this.status.isArticle=e,admin.selectTab("article/article")},getAndSet:function(){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/article/"+admin.article.status.id,type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){$("#title").val(t.article.articleTitle),admin.editors.articleEditor.setContent(t.article.articleContent),admin.editors.abstractEditor.setContent(t.article.articleAbstract),admin.article.content=admin.editors.articleEditor.getContent();for(var a=t.article.articleTags,i="",l=0;l<a.length;l++)0===l?i=a[l].tagTitle:i+=","+a[l].tagTitle;$("#tag").val(i),$("#permalink").val(t.article.articlePermalink),$("#viewPwd").val(t.article.articleViewPwd),$("#categorySelector").val(t.category),$("#articleCommentable").prop("checked",t.article.articleCommentable);var r=t.article.signs;$(".signs button").each((function(e){parseInt(t.article.articleSignId)===parseInt(r[e].oId)?$("#articleSign"+r[e].oId).addClass("selected"):$("#articleSign"+r[e].oId).removeClass("selected")}));var s=new Date;s.setTime(t.article.articleCreated),$("#createDate").val(function(t){var e=t.getFullYear(),a=t.getMonth()+1;a=a<10?"0"+a:a;var i=t.getDate();i=i<10?"0"+i:i;var l=t.getHours();l=l<10?"0"+l:l;var r=t.getMinutes();r=r<10?"0"+r:r;var s=t.getSeconds();return e+"-"+a+"-"+i+"T"+l+":"+r+":"+(s=s<10?"0"+s:s)}(s)),admin.article.setStatus(),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},del:function(t,e,a){confirm(Label.confirmRemoveLabel+Label.articleLabel+'"'+Util.htmlDecode(a)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/article/"+t,type:"DELETE",cache:!1,success:function(t,a){if($("#tipMsg").text(t.msg),t.sc)if(2===document.querySelectorAll("tr").length){const t=Math.max(admin[e+"List"].tablePagination.currentPage-1,1);admin[e+"List"].getList(t),admin.setHashByPage(t)}else admin[e+"List"].getList(admin[e+"List"].tablePagination.currentPage);else $("#loadMsg").text("")}}))},add:function(t){if(admin.article.validate()){var e=this;e._addDisabled(),$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var a="";$(".signs button").each((function(){"selected"===this.className&&(a=this.id.substr(this.id.length-1,1))}));var i=admin.editors.articleEditor.getContent(),l=admin.editors.abstractEditor.getContent();if($("#articleThumbnail").prop("checked")){var r=$(".thumbnail__img").css("background-image");i="![]("+r.substring(5,r.length-2).replace("w/768","w/960").replace("h/432","h/540")+")\n\n"+i}var s={article:{articleTitle:$("#title").val(),articleContent:i,articleAbstract:l,articleTags:this.trimUniqueArray($("#tag").val()).toString(),articlePermalink:$("#permalink").val(),articleStatus:t,articleSignId:a,postToCommunity:$("#postToCommunity").prop("checked"),articleCommentable:$("#articleCommentable").prop("checked"),articleViewPwd:$("#viewPwd").val(),category:$("#categorySelector").val()}},c=new Date($("#createDate").val()).getTime();isNaN(c)||(s.article.articleCreated=c),$.ajax({url:Label.servePath+"/console/article/",type:"POST",cache:!1,data:JSON.stringify(s),success:function(e){$("#tipMsg").text(e.msg),e.sc&&(admin.article.status.id=void 0,0===t?admin.selectTab("article/article-list"):admin.selectTab("article/draft-list"),admin.article.isConfirm=!1)},complete:function(t,a){e._removeDisabled(),$("#loadMsg").text(""),admin.inited()}})}},update:function(t){if(admin.article.validate()){var e=this;e._addDisabled(),$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var a="";$(".signs button").each((function(){"selected"===this.className&&(a=this.id.substr(this.id.length-1,1))}));var i=admin.editors.articleEditor.getContent(),l=admin.editors.abstractEditor.getContent();if($("#articleThumbnail").prop("checked")){var r=$(".thumbnail__img").css("background-image");i="![]("+r.substring(5,r.length-2).replace("w/768","w/960").replace("h/432","h/540")+") \n\n"+i}var s={article:{oId:this.status.id,articleTitle:$("#title").val(),articleContent:i,articleAbstract:l,articleTags:this.trimUniqueArray($("#tag").val()).toString(),articlePermalink:$("#permalink").val(),articleStatus:t,articleSignId:a,articleCommentable:$("#articleCommentable").prop("checked"),articleViewPwd:$("#viewPwd").val(),postToCommunity:$("#postToCommunity").prop("checked"),category:$("#categorySelector").val(),articleCreated:new Date($("#createDate").val()).getTime()}};$.ajax({url:Label.servePath+"/console/article/",type:"PUT",cache:!1,data:JSON.stringify(s),success:function(e,a){$("#tipMsg").text(e.msg),e.sc&&(0===t?admin.selectTab("article/article-list"):admin.selectTab("article/draft-list"),$("#tipMsg").text(Label.updateSuccLabel),admin.article.status.id=void 0,admin.article.isConfirm=!1)},complete:function(t,a){e._removeDisabled(),$("#loadMsg").text(""),admin.inited()}})}},setStatus:function(){$.ajax({url:Label.servePath+"/console/tags",type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){if(!(0>=t.tags.length)){$("#tagCheckboxPanel>span").remove("");for(var a="",i=0;i<t.tags.length;i++)a+="<span>"+t.tags[i].tagTitle+"</span>";$("#tagCheckboxPanel").html(a+'<div class="fn__clear"></div>'),$("#loadMsg").text("")}}else $("#loadMsg").text("")}}),this.status?this.status.isArticle?($("#unSubmitArticle").show(),$("#saveArticle").hide(),$("#submitArticle").show()):($("#submitArticle").show(),$("#unSubmitArticle").hide(),$("#saveArticle").show()):($("#submitArticle").show(),$("#unSubmitArticle").hide(),$("#saveArticle").show(),$("#postToCommunityPanel").show())},clear:function(){this.status={id:void 0,isArticle:void 0},this.setStatus(),$("#title").val(""),admin.editors.articleEditor.setContent(""),admin.editors.abstractEditor.setContent(""),$("#tag").val(""),$("#tagCheckboxPanel").hide().find("span").removeClass("selected"),$("#permalink").val(""),$("#articleCammentable").prop("checked",!0),$("#postToCommunity").prop("checked",!1),$(".signs button").each((function(t){this.className=0===t?"selected":""})),$("#articleThumbnail").prop("checked")&&$("#articleThumbnail").click()},init:function(t){$(".signs button").click((function(t){$(".signs button").removeClass("selected"),$(this).addClass("selected")})),$("#tipMsg").text(Label.uploadMsg),$.ajax({url:Label.servePath+"/console/tags",type:"GET",cache:!1,success:function(t,e){if($("#tipMsg").text(t.msg),t.sc){if(!(0>=t.tags.length)){for(var a=[],i=0;i<t.tags.length;i++)a.push(t.tags[i].tagTitle);$("#tag").completed({height:160,buttonText:Label.selectLabel,data:a}),$("#loadMsg").text("")}}else $("#loadMsg").text("")}}),$("#submitArticle").click((function(){admin.article.status.id?admin.article.update(0):admin.article.add(0)})),$("#saveArticle").click((function(){admin.article.status.id?admin.article.update(admin.article.status.isArticle?0:1):admin.article.add(1)})),$("#cancelDo").click((function(){history.go(-1)})),admin.editors.articleEditor=new SoloEditor({outline:!0,id:"articleContent",height:500,fun:t,previewMode:"both",resize:!1,typewriterMode:!0}),admin.editors.abstractEditor=new SoloEditor({id:"abstract",height:200,previewMode:"editor",resize:!0,typewriterMode:!1}),darkmode=!1,setInterval((function(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?darkmode||(console.log("Dark Mode."),darkmode=!0,admin.editors.articleEditor.editor.setTheme("dark"),admin.editors.abstractEditor.editor.setTheme("dark")):darkmode&&(console.log("Light Mode."),darkmode=!1,admin.editors.articleEditor.editor.setTheme("light"),admin.editors.abstractEditor.editor.setTheme("light"))}),1e3),$("#articleThumbnailBtn").click((function(){$.ajax({url:Label.servePath+"/console/thumbs?n=1&w=768&h=432",type:"GET",cache:!1,success:function(t,e){t.sc?$("#articleThumbnailBtn").prev().css("background-image","url("+t.data[0]+")"):$("#loadMsg").text(t.msg)}})})).click()},validate:function(){var t=admin.editors.articleEditor.getContent();if(""===$("#title").val().replace(/\s/g,""))$("#tipMsg").text(Label.titleEmptyLabel),$("#title").focus().val("");else{if(""!==t.replace(/\s/g,""))return!0;$("#tipMsg").text(Label.contentEmptyLabel)}return!1},unPublish:function(){if(confirm('\u79fb\u81f3\u8349\u7a3f\u7bb1\u5c06\u5bfc\u81f4\u672c\u6b21\u5bf9\u6587\u7ae0\u7684\u4fee\u6539\u4e22\u5931\uff0c\u5efa\u8bae\u5148\u70b9\u51fb"\u53d1\u5e03"\u5c06\u6587\u7ae0\u4fdd\u5b58\uff0c\u518d\u79fb\u81f3\u8349\u7a3f\u7bb1\u3002\u4f60\u786e\u5b9a\u8981\u7ee7\u7eed\u5417\uff1f')){var t=this;t._addDisabled(),$.ajax({url:Label.servePath+"/console/article/unpublish/"+admin.article.status.id,type:"PUT",cache:!1,success:function(t,e){$("#tipMsg").text(t.msg),t.sc&&(admin.selectTab("article/draft-list"),admin.article.status.id=void 0,admin.article.isConfirm=!1)},complete:function(e,a){t._removeDisabled(),$("#loadMsg").text("")}})}},trimUniqueArray:function(t){for(var e=(t=t.toString()).split(","),a=0;a<e.length;a++)e[a]=e[a].replace(/(^\s*)|(\s*$)/g,""),""===e[a]&&(e.splice(a,1),a--);return $.unique(e).toString()},prePost:function(){if($("#loadMsg").text(Label.loadingLabel),admin.article.content="",admin.editors.articleEditor.getContent){var t=admin.editors.articleEditor.getContent();"#article/article"===window.location.hash&&""!==t.replace(/\s/g,"")&&confirm(Label.editorPostLabel)&&admin.article.clear(),$("#tipMsg").text(""),$("#loadMsg").text("")}},_addDisabled:function(){$("#unSubmitArticle").attr("disabled","disabled"),$("#saveArticle").attr("disabled","disabled"),$("#submitArticle").attr("disabled","disabled")},_removeDisabled:function(){$("#unSubmitArticle").removeAttr("disabled"),$("#saveArticle").removeAttr("disabled"),$("#submitArticle").removeAttr("disabled")}},admin.register.article={obj:admin.article,init:admin.article.init,refresh:function(){admin.editors.abstractEditor.setContent(""),admin.editors.articleEditor.setContent(""),$("#loadMsg").text(""),$("#tipMsg").text(Label.uploadMsg)}};
admin.comment={open:function(e,t){this.getList(e,t),$("#"+t+"Comments").dialog("open")},getList:function(e,t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$("#"+t+"Comments").html("");var a="article";"page"===t&&(a="page"),$.ajax({url:Label.servePath+"/console/comments/"+a+"/"+e,type:"GET",cache:!1,success:function(a,n){if($("#tipMsg").text(a.msg),a.sc){for(var m=a.comments,s="",o=0;o<m.length;o++){var l="<a target='_blank' href='"+m[o].commentURL+"'>",c=m[o].commentContent;"http://"===m[o].commentURL&&(l="<a target='_blank'>"),s+="<div class='comment-title'><span class='fn__left'>"+l+m[o].commentName+"</a>",m[o].commentOriginalCommentName&&(s+="@"+m[o].commentOriginalCommentName),s+="</span><a title='"+Label.removeLabel+"' class='fn__right fn__pointer' href=\"javascript:admin.comment.del('"+m[o].oId+"', '"+t+"', '"+e+"')\">"+Label.removeLabel+"</a><span class='fn__right'>&nbsp;&nbsp;"+$.bowknot.getDate(m[o].commentTime)+"&nbsp;</span><div class='fn__clear'></div></div><div class='vditor-reset'>"+c+"</div>"}""===s&&(s=Label.noCommentLabel),$("#"+t+"Comments").html(s),Util.parseMarkdown(),Util.parseLanguage(),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},del:function(e,t,a){if(confirm(Label.confirmRemoveLabel+Label.commentLabel+"?")){$("#loadMsg").text(Label.loadingLabel);var n="article";"page"===t&&(n="page"),$.ajax({url:Label.servePath+"/console/"+n+"/comment/"+e,type:"DELETE",cache:!1,success:function(e,n){$("#tipMsg").text(e.msg),e.sc?(admin.comment.getList(a,t),$("#loadMsg").text("")):$("#loadMsg").text("")}})}}};
admin.articleList={tablePagination:new TablePaginate("article"),init:function(e){this.tablePagination.buildTable([{text:Label.titleLabel,index:"title",minWidth:110,style:"padding-left: 12px;font-size:14px;"},{text:Label.categoryLabel,index:"category",width:150,style:"padding-left: 12px;"},{text:Label.authorLabel,index:"author",width:150,style:"padding-left: 12px;"},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"},{text:Label.viewLabel,width:60,index:"articleViewCount",style:"padding-left: 12px;"},{text:Label.dateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(e);var a=this;$("#articleListBtn").click((function(){a.getList(e)})),$("#articleListInput").keypress((function(t){13===t.keyCode&&a.getList(e)}))},syncToHacpai:function(e){$.ajax({url:Label.servePath+"/console/article/push2rhy?id="+e,type:"GET",cache:!1,success:function(e,a){$("#tipMsg").text(Label.pushSuccLabel)}})},getList:function(e){var a=this;$("#loadMsg").text(Label.loadingLabel),$.ajax({url:Label.servePath+"/console/articles/status/published/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE+"?k="+$("#articleListInput").val(),type:"GET",cache:!1,success:function(t,i){if($("#tipMsg").text(t.msg),t.sc){for(var l=t.articles,n=[],c=0;c<l.length;c++){n[c]={},n[c].title='<a href="'+Label.servePath+l[c].articlePermalink+"\" target='_blank' title='"+l[c].articleTitle+"' class='no-underline'>"+l[c].articleTitle+"</a><span class='table-tag'>"+l[c].articleTags+"</span>",n[c].date=$.bowknot.getDate(l[c].articleCreateTime),n[c].comments=l[c].articleCommentCount,n[c].articleViewCount=l[c].articleViewCount,n[c].author=l[c].authorName,n[c].category=l[c].articleCategory;var o=l[c].articlePutTop?Label.cancelPutTopLabel:Label.putTopLabel;"true"===Label.b3logEnabled||"true"===Label.fishpiEnabled?n[c].expendRow="<a href='javascript:void(0)' onclick=\"admin.article.get('"+l[c].oId+"', true)\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+l[c].oId+"', 'article', '"+encodeURIComponent(l[c].articleTitle)+"')\">"+Label.removeLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.articleList.syncToHacpai('"+l[c].oId+"')\">"+Label.pushToHacpaiLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.articleList.popTop(this, '"+l[c].oId+"')\">"+o+"</a>                                <a href='javascript:void(0)' onclick=\"admin.comment.open('"+l[c].oId+"', 'article')\">"+Label.commentLabel+"</a>":n[c].expendRow="<a href='javascript:void(0)' onclick=\"admin.article.get('"+l[c].oId+"', true)\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+l[c].oId+"', 'article', '"+encodeURIComponent(l[c].articleTitle)+"')\">"+Label.removeLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.articleList.popTop(this, '"+l[c].oId+"')\">"+o+"</a>                                <a href='javascript:void(0)' onclick=\"admin.comment.open('"+l[c].oId+"', 'article')\">"+Label.commentLabel+"</a>"}a.tablePagination.updateTablePagination(n,e,t.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},popTop:function(e,a){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var t=$(e),i="canceltop",l=Label.putTopLabel;t.html()===Label.putTopLabel&&(i="puttop",l=Label.cancelPutTopLabel),$.ajax({url:Label.servePath+"/console/article/"+i+"/"+a,type:"PUT",cache:!1,success:function(e,a){$("#tipMsg").text(e.msg),e.sc?(t.html(l),$("#loadMsg").text("")):$("#loadMsg").text("")}})}},admin.register["article-list"]={obj:admin.articleList,init:admin.articleList.init,refresh:admin.articleList.getList};
admin.draftList={tablePagination:new TablePaginate("draft"),init:function(t){this.tablePagination.buildTable([{text:Label.titleLabel,index:"title",minWidth:110,style:"padding-left: 12px;font-size:14px;"},{text:Label.authorLabel,index:"author",width:150,style:"padding-left: 12px;"},{text:Label.commentLabel,index:"comments",width:80,style:"padding-left: 12px;"},{text:Label.viewLabel,width:60,index:"articleViewCount",style:"padding-left: 12px;"},{text:Label.dateLabel,index:"date",width:90,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.tablePagination.initCommentsDialog(),this.getList(t)},getList:function(t){$("#loadMsg").text(Label.loadingLabel);var e=this;$.ajax({url:Label.servePath+"/console/articles/status/unpublished/"+t+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(a,i){if($("#tipMsg").text(a.msg),a.sc){for(var l=a.articles,n=[],d=0;d<l.length;d++)n[d]={},n[d].tags=l[d].articleTags,n[d].date=$.bowknot.getDate(l[d].articleCreateTime),n[d].comments=l[d].articleCommentCount,n[d].articleViewCount=l[d].articleViewCount,n[d].author=l[d].authorName,n[d].title="<a class='no-underline' href='"+Label.servePath+l[d].articlePermalink+"' target='_blank'>"+l[d].articleTitle+"</a><span class='table-tag'>"+l[d].articleTags+"</span>",n[d].expendRow="<a href='javascript:void(0)' onclick=\"admin.article.get('"+l[d].oId+"', false);\">"+Label.updateLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.article.del('"+l[d].oId+"', 'draft', '"+encodeURIComponent(l[d].articleTitle)+"')\">"+Label.removeLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.comment.open('"+l[d].oId+"', 'draft')\">"+Label.commentLabel+"</a>";e.tablePagination.updateTablePagination(n,t,a.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},admin.register["draft-list"]={obj:admin.draftList,init:admin.draftList.init,refresh:admin.draftList.getList};
admin.pageList={tablePagination:new TablePaginate("page"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},id:"",init:function(e){this.tablePagination.buildTable([{text:"",index:"pageOrder",width:60,style:"padding-left: 12px;font-size:14px;"},{style:"padding-left: 12px;",text:Label.titleLabel,index:"pageTitle",width:300},{style:"padding-left: 12px;",text:Label.permalinkLabel,index:"pagePermalink",minWidth:100},{style:"padding-left: 12px;",text:Label.openMethodLabel,index:"pageTarget",width:120}]),this.tablePagination.initPagination(),this.getList(e)},getList:function(e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var a=this;$.ajax({url:Label.servePath+"/console/pages/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(t,i){if($("#tipMsg").text(t.msg),t.sc){var n=t.pages,g=[];admin.pageList.pageInfo.currentCount=n.length,admin.pageList.pageInfo.pageCount=0===t.pagination.paginationPageCount?1:t.pagination.paginationPageCount;for(var p=0;p<n.length;p++){g[p]={},0===p?1===n.length?g[p].pageOrder="":g[p].pageOrder='<div class="table-center" style="width:14px">                                        <span onclick="admin.pageList.changeOrder('+n[p].oId+", "+p+', \'down\');"                                         class="icon-move-down"></span></div>':p===n.length-1?g[p].pageOrder='<div class="table-center" style="width:14px">                                    <span onclick="admin.pageList.changeOrder('+n[p].oId+", "+p+', \'up\');" class="icon-move-up"></span>                                    </div>':g[p].pageOrder='<div class="table-center" style="width:38px">                                    <span onclick="admin.pageList.changeOrder('+n[p].oId+", "+p+', \'up\');" class="icon-move-up"></span>                                    <span onclick="admin.pageList.changeOrder('+n[p].oId+", "+p+', \'down\');" class="icon-move-down"></span>                                    </div>';var l="";""!==n[p].pageIcon&&(l="<img class='navigation-icon' src='"+n[p].pageIcon+"'/> "),g[p].pageTitle=l+"<a class='no-underline' href='"+n[p].pagePermalink+"' target='_blank'>"+n[p].pageTitle+"</a>",g[p].pagePermalink="<a class='no-underline' href='"+n[p].pagePermalink+"' target='_blank'>"+n[p].pagePermalink+"</a>",g[p].pageTarget=n[p].pageOpenTarget,g[p].expendRow="<span><a href='"+n[p].pagePermalink+"' target='_blank'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.pageList.get('"+n[p].oId+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.pageList.del('"+n[p].oId+"', '"+encodeURIComponent(n[p].pageTitle)+"')\">"+Label.removeLabel+"</a></span>"}a.tablePagination.updateTablePagination(g,e,t.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},get:function(e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/page/"+e,type:"GET",cache:!1,success:function(a,t){$("#tipMsg").text(a.msg),a.sc?(admin.pageList.id=e,$("#pageTitle").val(a.page.pageTitle),$("#pagePermalink").val(a.page.pagePermalink),$("#pageTarget").val(a.page.pageOpenTarget),$("#pageIcon").val(a.page.pageIcon),$("#loadMsg").text("")):$("#loadMsg").text("")}})},del:function(e,a){confirm(Label.confirmRemoveLabel+Label.navLabel+'"'+Util.htmlDecode(a)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/page/"+e,type:"DELETE",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.pageList.pageInfo.currentPage;1===admin.pageList.pageInfo.currentCount&&1!==admin.pageList.pageInfo.pageCount&&admin.pageList.pageInfo.currentPage===admin.pageList.pageInfo.pageCount&&(admin.pageList.pageInfo.pageCount--,t=admin.pageList.pageInfo.pageCount);var i=window.location.hash.split("/");t==i[i.length-1]?admin.pageList.getList(t):admin.setHashByPage(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#pagePermalink").val().replace(/(^\s*)|(\s*$)/g,""),a={page:{pageTitle:$("#pageTitle").val(),pagePermalink:e,pageOpenTarget:$("#pageTarget").val(),pageIcon:$("#pageIcon").val()}};$.ajax({url:Label.servePath+"/console/page/",type:"POST",cache:!1,data:JSON.stringify(a),success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){admin.pageList.id="",$("#pagePermalink").val(""),$("#pageTitle").val(""),$("#pageIcon").val(""),$("#pageTarget").val("_self"),admin.pageList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.pageList.pageInfo.currentPage===admin.pageList.pageInfo.pageCount&&admin.pageList.pageInfo.pageCount++;var t=window.location.hash.split("/");admin.pageList.pageInfo.pageCount==t[t.length-1]?admin.pageList.getList(admin.pageList.pageInfo.pageCount):admin.setHashByPage(admin.pageList.pageInfo.pageCount),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},update:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#pagePermalink").val().replace(/(^\s*)|(\s*$)/g,""),a={page:{pageTitle:$("#pageTitle").val(),oId:this.id,pagePermalink:e,pageOpenTarget:$("#pageTarget").val(),pageIcon:$("#pageIcon").val()}};$.ajax({url:Label.servePath+"/console/page/",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(e,a){$("#tipMsg").text(e.msg),e.sc?(admin.pageList.id="",admin.pageList.getList(admin.pageList.pageInfo.currentPage),$("#pageTitle").val(""),$("#pageIcon").val(""),$("#pagePermalink").val(""),$("#pageTarget").val("_self"),$("#loadMsg").text("")):$("#loadMsg").text("")}})}},validate:function(){if(""===$("#pageTitle").val().replace(/\s/g,""))$("#tipMsg").text(Label.titleEmptyLabel),$("#pageTitle").focus();else{if(""!==$("#pagePermalink").val().replace(/\s/g,""))return!0;$("#tipMsg").text(Label.linkEmptyLabel)}return!1},submit:function(){""!==this.id?this.update():this.add()},changeOrder:function(e,a,t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var i={oId:e.toString(),direction:t};$.ajax({url:Label.servePath+"/console/page/order/",type:"PUT",cache:!1,data:JSON.stringify(i),success:function(e,a){$("#tipMsg").text(e.msg),admin.pageList.getList(admin.pageList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["page-list"]={obj:admin.pageList,init:admin.pageList.init,refresh:admin.pageList.getList};
var lastOthers=-1;admin.others={init:function(){$("#tabOthers").tabs(),$("#loadMsg").text(""),admin.others.getLog(),setInterval(admin.others.getLog,5e3)},getLog:()=>{$.ajax({url:Label.servePath+"/admin/logs",cache:!1,timeout:2e3,success:function(t){let e=t.result,s=(t.freeMemNow/1048576).toFixed(2)+" MB";$("#memFree").html(s),$("#now").html((new Date).toLocaleTimeString());for(let t=0;t<e.length;t++){let s=e[t],a=s.id;if(a>lastOthers){let t=s.date,e=s.level,o=s.name+":"+s.lineNumber,l=s.message,n='<tbody class="table-oddRow"><tr class="table-hasExpend">';t=t.substring(0,19);let r="";r="WARN"===e?'<td style="width: 40px; vertical-align: top"><span style="color: #f8ba0b; font-weight: bold">'+e+"</span></td>":"INFO"===e?'<td style="width: 40px; vertical-align: top"><span style="color: #00bbff; font-weight: bold">'+e+"</span></td>":"ERROR"===e?'<td style="width: 40px; vertical-align: top"><span style="color: #dd1144" font-weight: bold">'+e+"</span></td>":'<td style="width: 40px; vertical-align: top"><span style="color: #1ea0c3" font-weight: bold">'+e+"</span></td>";let c=n+r+('<td style="width: 135px; vertical-align: top"><span style="color: #4caf50; font-weight: bold">'+t+"</span></td>")+('<td style="vertical-align: top"><span style="word-wrap: break-word; white-space: normal; word-break: break-all"><span style="color: #4caf50; font-weight: bold">'+o+"</span><br>"+l+"</span></td>")+"</tr></tbody>";if(void 0!==s.throwable){c+=s.throwable.class+": "+s.throwable.message+"<br>";for(let t=0;t<s.throwable.stackTrace.length;t++)c+=s.throwable.stackTrace[t]+"<br>"}$("#tabOthersPanel_log #logList").prepend(c),lastOthers=a}}}})},removeUnusedArchives:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/archive/unused",type:"DELETE",cache:!1,success:function(t,e){$("#tipMsg").text(t.msg)}})},removeUnusedTags:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/tag/unused",type:"DELETE",cache:!1,success:function(t,e){$("#tipMsg").text(t.msg)}})},exportSQL:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/export/sql",type:"GET",cache:!1,success:function(t,e){t.sc?$("#tipMsg").text(t.msg):window.location=Label.servePath+"/console/export/sql"}})},exportJSON:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/export/json",type:"GET",cache:!1,success:function(t,e){t.sc?$("#tipMsg").text(t.msg):window.location=Label.servePath+"/console/export/json"}})},exportHexo:function(){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/export/hexo",type:"GET",cache:!1,success:function(t,e){t.sc?$("#tipMsg").text(t.msg):window.location=Label.servePath+"/console/export/hexo"}})},getUnusedTags:function(){$.ajax({url:Label.servePath+"/console/tag/unused",type:"GET",cache:!1,success:function(t,e){($("#tipMsg").text(t.msg),t.sc)?t.unusedTags.length:$("#loadMsg").text("")}})},pbstart:function(){$.ajax({url:Label.servePath+"/PBC/run",type:"GET",cache:!1,success:function(t,e){$("#tipMsg").text("\u8bf7\u6c42\u5df2\u63d0\u4ea4")}})}},admin.register.others={obj:admin.others,init:admin.others.init,refresh:function(){admin.clearTip()}};
admin.linkList={tablePagination:new TablePaginate("link"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},id:"",init:function(i){this.tablePagination.buildTable([{text:"",index:"linkOrder",width:60},{style:"padding-left: 12px;",text:Label.linkTitleLabel,index:"linkTitle",width:230},{style:"padding-left: 12px;",text:Label.urlLabel,index:"linkAddress",minWidth:180},{style:"padding-left: 12px;",text:Label.linkDescriptionLabel,index:"linkDescription",width:360}]),this.tablePagination.initPagination(),this.getList(i),$("#updateLink").dialog({title:$("#updateLink").data("title"),width:700,height:350,modal:!0,hideFooter:!0})},getList:function(i){$("#loadMsg").text(Label.loadingLabel),0===i&&(i=1),this.pageInfo.currentPage=i;var n=this;$.ajax({url:Label.servePath+"/console/links/"+i+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(e,t){if($("#tipMsg").text(e.msg),e.sc){var a=e.links,l=[];admin.linkList.pageInfo.currentCount=a.length,admin.linkList.pageInfo.pageCount=0===e.pagination.paginationPageCount?1:e.pagination.paginationPageCount;for(var s=0;s<a.length;s++)l[s]={},0===s?1===a.length?l[s].linkOrder="":l[s].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.linkList.changeOrder('+a[s].oId+", "+s+', \'down\');" class="icon-move-down"></span>                            </div>':s===a.length-1?l[s].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.linkList.changeOrder('+a[s].oId+", "+s+', \'up\');" class="icon-move-up"></span>                            </div>':l[s].linkOrder='<div class="table-center" style="width:38px">                                <span onclick="admin.linkList.changeOrder('+a[s].oId+", "+s+', \'up\');" class="icon-move-up"></span>                                <span onclick="admin.linkList.changeOrder('+a[s].oId+", "+s+', \'down\');" class="icon-move-down"></span>                            </div>',l[s].linkTitle=a[s].linkTitle,l[s].linkAddress="<a target='_blank' class='no-underline' href='"+a[s].linkAddress+"'>"+a[s].linkAddress+"</a>",l[s].linkDescription=a[s].linkDescription,l[s].linkIcon=a[s].linkIcon,l[s].expendRow="<span><a href='"+a[s].linkAddress+"' target='_blank'>"+Label.viewLabel+"</a>                                  <a href='javascript:void(0)' onclick=\"admin.linkList.get('"+a[s].oId+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.linkList.del('"+a[s].oId+"', '"+encodeURIComponent(a[s].linkTitle)+"')\">"+Label.removeLabel+"</a></span>";n.tablePagination.updateTablePagination(l,i,e.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var i={link:{linkTitle:$("#linkTitle").val(),linkAddress:$("#linkAddress").val(),linkDescription:$("#linkDescription").val(),linkIcon:$("#linkIcon").val()}};$.ajax({url:Label.servePath+"/console/link/",type:"POST",cache:!1,data:JSON.stringify(i),success:function(i,n){if($("#tipMsg").text(i.msg),i.sc){$("#linkTitle").val(""),$("#linkAddress").val(""),$("#linkDescription").val(""),$("#linkIcon").val(""),admin.linkList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.linkList.pageInfo.currentPage===admin.linkList.pageInfo.pageCount&&admin.linkList.pageInfo.pageCount++;var e=window.location.hash.split("/");admin.linkList.pageInfo.pageCount!==parseInt(e[e.length-1])&&admin.setHashByPage(admin.linkList.pageInfo.pageCount),admin.linkList.getList(admin.linkList.pageInfo.pageCount),$("#loadMsg").text("")}else $("#loadMsg").text("")}})}},get:function(i){$("#loadMsg").text(Label.loadingLabel),$("#updateLink").dialog("open"),$.ajax({url:Label.servePath+"/console/link/"+i,type:"GET",cache:!1,success:function(n,e){$("#tipMsg").text(n.msg),n.sc?(admin.linkList.id=i,$("#linkTitleUpdate").val(n.link.linkTitle),$("#linkAddressUpdate").val(n.link.linkAddress),$("#linkDescriptionUpdate").val(n.link.linkDescription),$("#linkIconUpdate").val(n.link.linkIcon),$("#loadMsg").text("")):$("#loadMsg").text("")}})},update:function(){if(this.validate("Update")){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var i={link:{linkTitle:$("#linkTitleUpdate").val(),oId:this.id,linkAddress:$("#linkAddressUpdate").val(),linkDescription:$("#linkDescriptionUpdate").val(),linkIcon:$("#linkIconUpdate").val()}};$.ajax({url:Label.servePath+"/console/link/",type:"PUT",cache:!1,data:JSON.stringify(i),success:function(i,n){$("#updateLink").dialog("close"),$("#tipMsg").text(i.msg),i.sc?(admin.linkList.getList(admin.linkList.pageInfo.currentPage),$("#loadMsg").text("")):$("#loadMsg").text("")}})}},del:function(i,n){confirm(Label.confirmRemoveLabel+Label.permalinkLabel+'"'+Util.htmlDecode(n)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/link/"+i,type:"DELETE",cache:!1,success:function(i,n){if($("#tipMsg").text(i.msg),i.sc){var e=admin.linkList.pageInfo.currentPage;1===admin.linkList.pageInfo.currentCount&&1!==admin.linkList.pageInfo.pageCount&&admin.linkList.pageInfo.currentPage===admin.linkList.pageInfo.pageCount&&(admin.linkList.pageInfo.pageCount--,e=admin.linkList.pageInfo.pageCount);var t=window.location.hash.split("/");e!==parseInt(t[t.length-1])&&admin.setHashByPage(e),admin.linkList.getList(e),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},validate:function(i){if(i||(i=""),""===$("#linkTitle"+i).val().replace(/\s/g,""))$("#tipMsg").text(Label.titleEmptyLabel),$("#linkTitle"+i).focus().val("");else if(""===$("#linkAddress"+i).val().replace(/\s/g,""))$("#tipMsg").text(Label.addressEmptyLabel),$("#linkAddress"+i).focus().val("");else{if(/^\w+:\/\//.test($("#linkAddress"+i).val()))return!0;$("#tipMsg").text(Label.addressInvalidLabel),$("#linkAddress"+i).focus().val("")}return!1},changeOrder:function(i,n,e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var t={oId:i.toString(),direction:e};$.ajax({url:Label.servePath+"/console/link/order/",type:"PUT",cache:!1,data:JSON.stringify(t),success:function(i,n){$("#tipMsg").text(i.msg),admin.linkList.getList(admin.linkList.pageInfo.currentPage),$("#loadMsg").text("")}})}},admin.register["link-list"]={obj:admin.linkList,init:admin.linkList.init,refresh:admin.linkList.getList};
admin.preference={locale:"",editorMode:"",init:function(){$("#tabPreference").tabs(),$.ajax({url:Label.servePath+"/console/preference/",type:"GET",cache:!1,success:function(result,textStatus){if($("#tipMsg").text(result.msg),result.sc){var preference=result.preference;$.ajax({url:Label.servePath+"/plugins/kanbanniang/assets/list",type:"GET",async:!1,success:function(e){for(var t=e.msg.split(";"),a=0;a<t.length;a++)$("#kanbanniangSelector").append('<option value="'+t[a]+'">'+t[a]+"</option>")}}),""===preference.wafCurrentLimitTimes||void 0===preference.wafCurrentLimitTimes?$("#wafCurrentLimitTimes").val("180"):$("#wafCurrentLimitTimes").val(preference.wafCurrentLimitTimes),""===preference.wafCurrentLimitSecond||void 0===preference.wafCurrentLimitSecond?$("#wafCurrentLimitSecond").val("180"):$("#wafCurrentLimitSecond").val(preference.wafCurrentLimitSecond),""===preference.wafPower||void 0===preference.wafPower?$("#wafPower").val("on"):$("#wafPower").val(preference.wafPower),""===preference.interactive||void 0===preference.interactive?$("#interactiveSwitch").val("on"):$("#interactiveSwitch").val(preference.interactive),""===preference.adminActiveSentToMailbox||void 0===preference.adminActiveSentToMailbox?$("#adminActiveSentToMailbox").val("on"):$("#adminActiveSentToMailbox").val(preference.adminActiveSentToMailbox),$("#sendKey").val(preference.sendKey),$("#spam").val(preference.spam),$("#kanbanniangSelector").val(preference.kanbanniangSelector),$("#replyRemind").val(preference.replyRemind),$("#sourceTC").text(preference.tuChuangConfig),sltd=$("#sourceTC").text().split("<<>>")[0],$("#tcS").val(sltd),$("#hacpaiUser").val(preference.hacpaiUser),$("#b3logKey").val(preference.b3logKey),$("#fishpiKey").val(preference.fishKey),$("#mailBox").val(preference.mailBox),$("#mailUsername").val(preference.mailUsername),$("#mailPassword").val(preference.mailPassword),$("#metaKeywords").val(preference.metaKeywords),$("#metaDescription").val(preference.metaDescription),$("#blogTitle").val(preference.blogTitle),$("#blogSubtitle").val(preference.blogSubtitle),$("#mostCommentArticleDisplayCount").val(preference.mostCommentArticleDisplayCount),$("#mostViewArticleDisplayCount").val(preference.mostViewArticleDisplayCount),$("#recentCommentDisplayCount").val(preference.recentCommentDisplayCount),$("#mostUsedTagDisplayCount").val(preference.mostUsedTagDisplayCount),$("#articleListDisplayCount").val(preference.articleListDisplayCount),$("#articleListPaginationWindowSize").val(preference.articleListPaginationWindowSize),$("#localeString").val(preference.localeString),$("#timeZoneId").val(preference.timeZoneId),$("#noticeBoard").val(preference.noticeBoard),$("#footerContent").val(preference.footerContent),$("#htmlHead").val(preference.htmlHead),$("#relevantArticlesDisplayCount").val(preference.relevantArticlesDisplayCount),$("#randomArticlesDisplayCount").val(preference.randomArticlesDisplayCount),$("#customVars").val(preference.customVars),$("#githubPAT").val(preference.githubPAT),$("#maxArchive").val(preference.maxArchive),$("#myGitHubID").val(preference.myGitHubID),"true"===preference.enableAutoFlushGitHub?$("#enableAutoFlushGitHub").attr("checked","checked"):$("#enableAutoFlushGitHub").removeAttr("checked"),"true"===preference.showCodeBlockLn?$("#showCodeBlockLn").attr("checked","checked"):$("#showCodeBlockLn").removeAttr("checked"),"true"===preference.enableArticleUpdateHint?$("#enableArticleUpdateHint").attr("checked","checked"):$("#enableArticleUpdateHint").removeAttr("checked"),"true"===preference.allowVisitDraftViaPermalink?$("#allowVisitDraftViaPermalink").attr("checked","checked"):$("allowVisitDraftViaPermalink").removeAttr("checked"),"true"===preference.commentable?$("#commentable").attr("checked","checked"):$("commentable").removeAttr("checked"),"true"===preference.syncGitHub?$("#syncGitHub").attr("checked","checked"):$("syncGitHub").removeAttr("checked"),"true"===preference.pullGitHub?$("#pullGitHub").attr("checked","checked"):$("pullGitHub").removeAttr("checked"),"true"===preference.welfareLuteService?$("#welfareLuteService").attr("checked","checked"):$("#welfareLuteService").removeAttr("checked"),"true"===preference.helpImprovePlan?$("#helpImprovePlan").attr("checked","checked"):$("#helpImprovePlan").removeAttr("checked"),$("input:radio[value='"+preference.editorMode+"']").attr("checked","true"),admin.preference.editorMode=preference.editorMode,admin.preference.locale=preference.localeString;for(var signs=eval("("+preference.signs+")"),j=1;j<signs.length;j++)$("#preferenceSign"+j).val(signs[j].signHTML);$("#articleListDisplay").val(preference.articleListStyle),$("#hljsTheme").val(preference.hljsTheme),$("#feedOutputMode").val(preference.feedOutputMode),$("#feedOutputCnt").val(preference.feedOutputCnt),$("#imageUploadCompress").val(preference.imageUploadCompress),$("#thumbCompress").val(preference.thumbCompress),$("#faviconURL").val(preference.faviconURL),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},validate:function(){return/^\d+$/.test($("#mostUsedTagDisplayCount").val())?/^\d+$/.test($("#recentCommentDisplayCount").val())?/^\d+$/.test($("#mostCommentArticleDisplayCount").val())?/^\d+$/.test($("#mostViewArticleDisplayCount").val())?/^\d+$/.test($("#articleListDisplayCount").val())?/^\d+$/.test($("#articleListPaginationWindowSize").val())?/^\d+$/.test($("#randomArticlesDisplayCount").val())?/^\d+$/.test($("#relevantArticlesDisplayCount").val())?!(!/^\d+$/.test($("#wafCurrentLimitTimes").val())||$("#wafCurrentLimitTimes").val()<2||$("#wafCurrentLimitTimes").val()>2147483647||!/^\d+$/.test($("#wafCurrentLimitSecond").val())||$("#wafCurrentLimitSecond").val()<2||$("#wafCurrentLimitSecond").val()>2147483647)||($("#tipMsg").text("\u8bbf\u95ee\u9891\u7387\u6b21\u6570\u4e0e\u65f6\u95f4\u5fc5\u987b\u5728 2-2147483647 \u4e4b\u95f4!"),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.relevantArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#relevantArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.randomArticlesDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#randomArticlesDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.windowSizeLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#articleListPaginationWindowSize").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.pageSizeLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#articleListDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexMostViewArticleDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostViewArticleDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexMostCommentArticleDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostCommentArticleDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexRecentCommentDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#recentCommentDisplayCount").focus(),!1):($("#tipMsg").text("["+Label.paramSettingsLabel+" - "+Label.indexTagDisplayCntLabel+"] "+Label.nonNegativeIntegerOnlyLabel),$("#mostUsedTagDisplayCount").focus(),!1)},update:function(){if(admin.preference.validate()){noBtnSwal("\u8bf7\u7a0d\u5019",0),$("#tipMsg").text(""),$("#loadMsg").text("");var e=[{oId:0,signHTML:""},{oId:1,signHTML:$("#preferenceSign1").val()},{oId:2,signHTML:$("#preferenceSign2").val()},{oId:3,signHTML:$("#preferenceSign3").val()}];null===$("#interactiveSwitch").val()&&$("#interactiveSwitch").val("on");var t={preference:{helpImprovePlan:$("#helpImprovePlan").prop("checked"),enableAutoFlushGitHub:$("#enableAutoFlushGitHub").prop("checked"),welfareLuteService:$("#welfareLuteService").prop("checked"),sendKey:$("#sendKey").val(),myGitHubID:$("#myGitHubID").val(),adminActiveSentToMailbox:$("#adminActiveSentToMailbox").val(),wafCurrentLimitTimes:$("#wafCurrentLimitTimes").val(),wafCurrentLimitSecond:$("#wafCurrentLimitSecond").val(),wafPower:$("#wafPower").val(),interactive:$("#interactiveSwitch").val(),spam:$("#spam").val(),kanbanniangSelector:$("#kanbanniangSelector").val(),replyRemind:$("#replyRemind").val(),tuChuangConfig:$("#sourceTC").text(),hacpaiUser:$("#hacpaiUser").val(),b3logKey:$("#b3logKey").val(),fishKey:$("#fishpiKey").val(),mailBox:$("#mailBox").val(),mailUsername:$("#mailUsername").val(),mailPassword:$("#mailPassword").val(),metaKeywords:$("#metaKeywords").val(),metaDescription:$("#metaDescription").val(),blogTitle:$("#blogTitle").val(),blogSubtitle:$("#blogSubtitle").val(),mostCommentArticleDisplayCount:$("#mostCommentArticleDisplayCount").val(),mostViewArticleDisplayCount:$("#mostViewArticleDisplayCount").val(),recentCommentDisplayCount:$("#recentCommentDisplayCount").val(),mostUsedTagDisplayCount:$("#mostUsedTagDisplayCount").val(),articleListDisplayCount:$("#articleListDisplayCount").val(),articleListPaginationWindowSize:$("#articleListPaginationWindowSize").val(),localeString:$("#localeString").val(),timeZoneId:$("#timeZoneId").val(),noticeBoard:$("#noticeBoard").val(),footerContent:$("#footerContent").val(),htmlHead:$("#htmlHead").val(),relevantArticlesDisplayCount:$("#relevantArticlesDisplayCount").val(),randomArticlesDisplayCount:$("#randomArticlesDisplayCount").val(),enableArticleUpdateHint:$("#enableArticleUpdateHint").prop("checked"),signs:e,allowVisitDraftViaPermalink:$("#allowVisitDraftViaPermalink").prop("checked"),articleListStyle:$("#articleListDisplay").val(),hljsTheme:$("#hljsTheme").val(),feedOutputMode:$("#feedOutputMode").val(),feedOutputCnt:$("#feedOutputCnt").val(),imageUploadCompress:$("#imageUploadCompress").val(),thumbCompress:$("#thumbCompress").val(),faviconURL:$("#faviconURL").val(),syncGitHub:$("#syncGitHub").prop("checked"),showCodeBlockLn:$("#showCodeBlockLn").prop("checked"),pullGitHub:$("#pullGitHub").prop("checked"),commentable:$("#commentable").prop("checked"),customVars:$("#customVars").val(),githubPAT:$("#githubPAT").val(),maxArchive:$("#maxArchive").val(),editorMode:$("input[name='editorMode']:checked").val()}};$.ajax({url:Label.servePath+"/console/preference/",type:"PUT",cache:!1,data:JSON.stringify(t),success:function(e,t){$("#tipMsg").text(e.msg),e.sc?($("#localeString").val()===admin.preference.locale&&$("input[name='editorMode']:checked").val()===admin.preference.editorMode||window.location.reload(),window.location.reload()):$("#loadMsg").text("")}})}}},admin.register.preference={obj:admin.preference,init:admin.preference.init,refresh:function(){admin.clearTip()}};
admin.themeList={skinDirName:"",mobileSkinDirName:"",init:function(){$.ajax({url:Label.servePath+"/console/skin",type:"GET",cache:!1,success:function(i,e){if($("#tipMsg").text(i.msg),i.sc){admin.themeList.skinDirName=i.skin.skinDirName,admin.themeList.mobileSkinDirName=i.skin.mobileSkinDirName;for(var s=JSON.parse(i.skin.skins),a="",t=0;t<s.length;t++){var n="";s[t].skinDirName===i.skin.skinDirName&&(n=" selected"),a+='<div class="fn__left skinItem'+n+'"><div class="ft__center">'+s[t].skinDirName+'<p class="skinDesc">'+s[t].skinName+'</p></div><img class="skinPreview" src="'+Label.staticServePath+"/skins/"+s[t].skinDirName+'/preview.png"/><div>',s[t].skinDirName!==i.skin.skinDirName&&(a+='<button class="small update fn__left" data-name="'+s[t].skinDirName+'">'+Label.enableLabel+"</button>"),s[t].skinDirName!==i.skin.mobileSkinDirName&&(a+='<button class="small mobile fn__left" data-name="'+s[t].skinDirName+'">'+Label.setMobileLabel+"</button>"),a+='<button class="small fn__right" onclick="window.open(\''+Label.servePath+"?skin="+s[t].skinDirName+"')\">"+Label.previewLabel+"</button></div></div>"}$("#skinMain").html(a+"<div class='fn__clear'></div>"),$(".skinItem .update").click((function(){admin.themeList.update($(this).data("name"),"pc")})),$(".skinItem .mobile").click((function(){admin.themeList.update($(this).data("name"),"mobile")})),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},update:function(i,e){$("#tipMsg").text(""),$("#loadMsg").text(Label.loadingLabel);var s={skin:{skinDirName:admin.themeList.skinDirName,mobileSkinDirName:admin.themeList.mobileSkinDirName}};"pc"===e?s.skin.skinDirName=i:s.skin.mobileSkinDirName=i,$.ajax({url:Label.servePath+"/console/skin",type:"PUT",cache:!1,data:JSON.stringify(s),success:function(i,e){$("#tipMsg").text(i.msg),i.sc?(admin.themeList.init(),$("#loadMsg").text("")):$("#loadMsg").text("")}})}},admin.register["theme-list"]={obj:admin.themeList,init:admin.themeList.init,refresh:function(){$("#loadMsg").text("")}};
admin.pluginList={tablePagination:new TablePaginate("plugin"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},init:function(t){this.tablePagination.buildTable([{style:"padding-left: 12px;",text:Label.pluginNameLabel,index:"name",width:230},{style:"padding-left: 12px;",text:Label.statusLabel,index:"status",minWidth:80},{style:"padding-left: 12px;",text:Label.authorLabel,index:"author",width:200},{style:"padding-left: 12px;",text:Label.versionLabel,index:"version",width:120}]),this.tablePagination.initPagination(),$("#pluginSetting").dialog({width:700,height:180,modal:!0,hideFooter:!0}),this.getList(t)},getList:function(t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=this;$.ajax({url:Label.servePath+"/console/plugins/"+t+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(a,i){if($("#tipMsg").text(a.msg),a.sc){admin.pluginList.pageInfo.currentPage=t;for(var n=a.plugins,l=0;l<n.length;l++)n[l].expendRow="<a href='javascript:void(0)' onclick=\"admin.pluginList.changeStatus('"+n[l].oId+"', '"+n[l].status+"')\">","ENABLED"===n[l].status?(n[l].status=Label.enabledLabel,n[l].expendRow+=Label.disableLabel):(n[l].status=Label.disabledLabel,n[l].expendRow+=Label.enableLabel),n[l].expendRow+="</a>  ","{}"!=n[l].setting&&(n[l].expendRow+="<a href='javascript:void(0)' onclick=\"admin.pluginList.toSetting('"+n[l].oId+"')\"> "+Label.settingLabel+" </a>  ");e.tablePagination.updateTablePagination(a.plugins,t,a.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},toSetting:function(t){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={oId:t};$.ajax({url:Label.servePath+"/console/plugin/toSetting",type:"POST",cache:!1,data:JSON.stringify(e),success:function(t,e){$("#tipMsg").text(t.msg),$("#pluginSetting").html(t),$("#pluginSetting").dialog("open"),$("#loadMsg").text("")}})},changeStatus:function(t,e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var a={oId:t,status:e="ENABLED"===e?"DISABLED":"ENABLED"};$.ajax({url:Label.servePath+"/console/plugin/status/",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(t,e){$("#tipMsg").text(t.msg),t.sc?($("#loadMsg").text(""),window.location.reload()):$("#loadMsg").text("")}})}},admin.register["plugin-list"]={obj:admin.pluginList,init:admin.pluginList.init,refresh:function(){$("#loadMsg").text("")}};
admin.userList={tablePagination:new TablePaginate("user"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},userInfo:{oId:"",userRole:""},init:function(e){this.tablePagination.buildTable([{style:"padding-left: 12px;",text:Label.userNameLabel,index:"userName",width:230},{style:"padding-left: 12px;",text:Label.roleLabel,index:"isAdmin",width:120}]),this.tablePagination.initPagination(),this.getList(e),$("#userUpdate").dialog({width:700,height:450,modal:!0,hideFooter:!0})},getList:function(e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),this.pageInfo.currentPage=e;var a=this;$.ajax({url:Label.servePath+"/console/users/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(t,s){if($("#tipMsg").text(t.msg),t.sc){var i=t.users,n=[];if(admin.userList.pageInfo.currentCount=i.length,admin.userList.pageInfo.pageCount=t.pagination.paginationPageCount,i.length<1)return $("#tipMsg").text("No user  "+Label.reportIssueLabel),void $("#loadMsg").text("");$("#tipMsg").text(Label.uploadMsg);for(var o=0;o<i.length;o++)n[o]={},n[o].userName=i[o].userName,"adminRole"===i[o].userRole?(n[o].isAdmin="&nbsp;"+Label.administratorLabel,n[o].expendRow="<a href='javascript:void(0)' onclick=\"admin.userList.get('"+i[o].oId+"', '"+i[o].userRole+"')\">"+Label.updateLabel+"</a>"):(n[o].expendRow="<a href='javascript:void(0)' onclick=\"admin.userList.get('"+i[o].oId+"', '"+i[o].userRole+"')\">"+Label.updateLabel+"</a>                                <a href='javascript:void(0)' onclick=\"admin.userList.del('"+i[o].oId+"', '"+encodeURIComponent(i[o].userName)+"')\">"+Label.removeLabel+"</a> <a href='javascript:void(0)' onclick=\"admin.userList.changeRole('"+i[o].oId+"')\">"+Label.changeRoleLabel+"</a>","defaultRole"===i[o].userRole?n[o].isAdmin=Label.commonUserLabel:n[o].isAdmin=Label.visitorUserLabel),a.tablePagination.updateTablePagination(n,e,t.pagination);$("#loadMsg").text("")}else $("#loadMsg").text("")}})},get:function(e,a){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$("#userUpdate").dialog("open"),$.ajax({url:Label.servePath+"/console/user/"+e,type:"GET",cache:!1,success:function(t,s){$("#tipMsg").text(t.msg),t.sc?($("#userURLUpdate").val(t.user.userURL),$("#userAvatarUpdate").val(t.user.userAvatar),$("#userB3KeyUpdate").val(""),$("#userNameUpdate").val(t.user.userName).data("userInfo",{oId:e,userRole:a}),$("#loadMsg").text("")):$("#loadMsg").text("")}})},update:function(){if(this.validate("Update")){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e=$("#userNameUpdate").data("userInfo"),a={userName:$("#userNameUpdate").val(),oId:e.oId,userURL:$("#userURLUpdate").val(),userRole:e.userRole,userAvatar:$("#userAvatarUpdate").val(),userB3Key:$("#userB3KeyUpdate").val()};$.ajax({url:Label.servePath+"/console/user/",type:"PUT",cache:!1,data:JSON.stringify(a),success:function(e,a){$("#userUpdate").dialog("close"),$("#tipMsg").text(e.msg),e.sc?(admin.userList.getList(admin.userList.pageInfo.currentPage),$("#loadMsg").text("")):$("#loadMsg").text("")}})}},del:function(e,a){confirm(Label.confirmRemoveLabel+Label.userLabel+'"'+Util.htmlDecode(a)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/user/"+e,type:"DELETE",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.userList.pageInfo.currentPage;1===admin.userList.pageInfo.currentCount&&1!==admin.userList.pageInfo.pageCount&&admin.userList.pageInfo.currentPage===admin.userList.pageInfo.pageCount&&(admin.userList.pageInfo.pageCount--,t=admin.userList.pageInfo.pageCount);var s=window.location.hash.split("/");t!==parseInt(s[s.length-1])&&admin.setHashByPage(t),admin.userList.getList(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}}))},changeRole:function(e){$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/changeRole/"+e,type:"GET",cache:!1,success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){var t=admin.userList.pageInfo.currentPage;1===admin.userList.pageInfo.currentCount&&1!==admin.userList.pageInfo.pageCount&&admin.userList.pageInfo.currentPage===admin.userList.pageInfo.pageCount&&(admin.userList.pageInfo.pageCount--,t=admin.userList.pageInfo.pageCount);var s=window.location.hash.split("/");t!==parseInt(s[s.length-1])&&admin.setHashByPage(t),admin.userList.getList(t),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},validate:function(e){e||(e="");var a=$("#userName"+e).val().replace(/(^\s*)|(\s*$)/g,"");return!(2>a.length||a.length>20)||($("#tipMsg").text(Label.nameTooLongLabel),$("#userName"+e).focus(),!1)}},admin.register["user-list"]={obj:admin.userList,init:admin.userList.init,refresh:admin.userList.getList};
admin.categoryList={tablePagination:new TablePaginate("category"),pageInfo:{currentCount:1,pageCount:1,currentPage:1},init:function(e){this.tablePagination.buildTable([{text:"",index:"linkOrder",width:60},{style:"padding-left: 12px;",text:Label.titleLabel,index:"categoryTitle",width:230},{style:"padding-left: 12px;",text:"URI",index:"categoryURI",width:230},{style:"padding-left: 12px;",text:Label.descriptionLabel,index:"categoryDesc",minWidth:180}]),this.tablePagination.initPagination(),this.getList(e),$.ajax({url:Label.servePath+"/console/tags",type:"GET",cache:!1,success:function(e,t){if($("#tipMsg").text(e.msg),e.sc){if(!(0>=e.tags.length)){for(var a=[],o=0;o<e.tags.length;o++)a.push(e.tags[o].tagTitle);$("#categoryTags").completed({height:160,buttonText:Label.selectLabel,data:a}),$("#loadMsg").text("")}}else $("#loadMsg").text("")}})},getList:function(e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),this.pageInfo.currentPage=e;var t=this;$.ajax({url:Label.servePath+"/console/categories/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(a,o){if($("#tipMsg").text(a.msg),a.sc){var i=a.categories,n=[];admin.categoryList.pageInfo.currentCount=i.length,admin.categoryList.pageInfo.pageCount=0===a.pagination.paginationPageCount?1:a.pagination.paginationPageCount;for(var g=0;g<i.length;g++)n[g]={},0===g?1===i.length?n[g].linkOrder="":n[g].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.categoryList.changeOrder('+i[g].oId+", "+g+', \'down\');" class="icon-move-down"></span>                            </div>':g===i.length-1?n[g].linkOrder='<div class="table-center" style="width:14px">                                <span onclick="admin.categoryList.changeOrder('+i[g].oId+", "+g+', \'up\');" class="icon-move-up"></span>                            </div>':n[g].linkOrder='<div class="table-center" style="width:38px">                                <span onclick="admin.categoryList.changeOrder('+i[g].oId+", "+g+', \'up\');" class="icon-move-up"></span>                                <span onclick="admin.categoryList.changeOrder('+i[g].oId+", "+g+', \'down\');" class="icon-move-down"></span>                            </div>',n[g].categoryTitle=i[g].categoryTitle,n[g].categoryURI=i[g].categoryURI,n[g].categoryDesc=i[g].categoryDescription,n[g].expendRow="<a href='javascript:void(0)' onclick=\"admin.categoryList.get('"+i[g].oId+"')\">"+Label.updateLabel+"</a>                            <a href='javascript:void(0)' onclick=\"admin.categoryList.del('"+i[g].oId+"', '"+encodeURIComponent(i[g].categoryTitle)+"')\">"+Label.removeLabel+"</a> ";t.tablePagination.updateTablePagination(n,e,a.pagination),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},add:function(){if(this.validate()){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var e={categoryTitle:$("#categoryName").val(),categoryURI:$("#categoryURI").val(),categoryDescription:$("#categoryDesc").val()},t=$("#categoryName").data("oId"),a="POST";t&&(e.oId=t,a="PUT"),$.ajax({url:Label.servePath+"/console/category/",type:a,cache:!1,data:JSON.stringify(e),success:function(e,a){if($("#tipMsg").text(e.msg),e.sc){if(!t){admin.categoryList.pageInfo.currentCount===Label.PAGE_SIZE&&admin.categoryList.pageInfo.currentPage===admin.categoryList.pageInfo.pageCount&&admin.categoryList.pageInfo.pageCount++;var o=window.location.hash.split("/");admin.categoryList.pageInfo.pageCount!==parseInt(o[o.length-1])&&admin.setHashByPage(admin.categoryList.pageInfo.pageCount)}$("#categoryName").val("").data("oId",""),$("#categoryURI").val(""),$("#categoryDesc").val(""),admin.categoryList.getList(admin.categoryList.pageInfo.pageCount),$("#loadMsg").text(""),location.reload()}else $("#loadMsg").text("")}})}},get:function(e){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/category/"+e,type:"GET",cache:!1,success:function(t,a){$("#tipMsg").text(t.msg),t.sc?($("#categoryName").val(t.categoryTitle).data("oId",e),$("#categoryURI").val(t.categoryURI),$("#categoryDesc").val(t.categoryDescription),$("#categoryTags").val(t.categoryTags),$("#loadMsg").text("")):$("#loadMsg").text("")}})},del:function(e,t){confirm(Label.confirmRemoveLabel+Label.categoryLabel+'"'+Util.htmlDecode(t)+'"?')&&($("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text(""),$.ajax({url:Label.servePath+"/console/category/"+e,type:"DELETE",cache:!1,success:function(e,t){if($("#tipMsg").text(e.msg),e.sc){var a=admin.categoryList.pageInfo.currentPage;1===admin.categoryList.pageInfo.currentCount&&1!==admin.categoryList.pageInfo.pageCount&&admin.categoryList.pageInfo.currentPage===admin.categoryList.pageInfo.pageCount&&(admin.categoryList.pageInfo.pageCount--,a=admin.categoryList.pageInfo.pageCount);var o=window.location.hash.split("/");a!==parseInt(o[o.length-1])&&admin.setHashByPage(a),admin.categoryList.getList(a),$("#loadMsg").text(""),location.reload()}else $("#loadMsg").text("")}}))},validate:function(e){e||(e="");var t=$("#categoryName"+e).val().replace(/(^\s*)|(\s*$)/g,"");return!(2>t.length||t.length>32)||($("#tipMsg").text(Label.categoryTooLongLabel),$("#categoryName"+e).focus(),!1)},changeOrder:function(e,t,a){$("#loadMsg").text(Label.loadingLabel),$("#tipMsg").text("");var o={oId:e.toString(),direction:a};$.ajax({url:Label.servePath+"/console/category/order/",type:"PUT",cache:!1,data:JSON.stringify(o),success:function(e,t){$("#tipMsg").text(e.msg),admin.categoryList.getList(admin.categoryList.pageInfo.currentPage),$("#loadMsg").text(""),location.reload()}})}},admin.register["category-list"]={obj:admin.categoryList,init:admin.categoryList.init,refresh:admin.categoryList.getList};
admin.commentList={tablePagination:new TablePaginate("comment"),pageInfo:{currentPage:1},init:function(e){this.tablePagination.buildTable([{text:Label.commentContentLabel,index:"content",minWidth:174,style:"padding-left: 12px;"},{text:Label.authorLabel,index:"title",style:"padding-left: 12px;",width:154},{text:Label.dateLabel,index:"date",width:154,style:"padding-left: 12px;"}]),this.tablePagination.initPagination(),this.getList(e)},getList:function(e){var t=this;$("#loadMsg").text(Label.loadingLabel),$.ajax({url:Label.servePath+"/console/comments/"+e+"/"+Label.PAGE_SIZE+"/"+Label.WINDOW_SIZE,type:"GET",cache:!1,success:function(a,n){if($("#tipMsg").text(a.msg),a.sc){t.pageInfo.currentPage=e;for(var i=a.comments,l=[],o=0;o<i.length;o++){l[o]={},l[o].content='<div class="vditor-reset">'+i[o].commentContent+"</div><span class='table-tag'> on &nbsp;&nbsp;</span><a href='"+Label.servePath+i[o].commentSharpURL+"' target='_blank'>"+i[o].commentTitle+"</a>",l[o].expendRow="<a href='javascript:void(0)' onclick=\"admin.commentList.del('"+i[o].oId+"', 'Article')\">"+Label.removeLabel+"</a>",l[o].title="<img class='small-head' src='"+i[o].commentThumbnailURL+"'/>","http://"===i[o].commentURL?l[o].title+=i[o].commentName:l[o].title+="<a href='"+i[o].commentURL+"' target='_blank' class='no-underline'>"+i[o].commentName+"</a>",l[o].title+="<br/>",l[o].date=$.bowknot.getDate(i[o].commentTime)}t.tablePagination.updateTablePagination(l,e,a.pagination),Util.parseMarkdown(),Util.parseLanguage(),$("#loadMsg").text("")}else $("#loadMsg").text("")}})},del:function(e,t){confirm(Label.confirmRemoveLabel+Label.commentLabel+"?")&&($("#loadMsg").text(Label.loadingLabel),$.ajax({url:Label.servePath+"/console/"+t.toLowerCase()+"/comment/"+e,type:"DELETE",cache:!1,success:function(e,t){$("#tipMsg").text(e.msg),e.sc?(admin.commentList.getList(admin.commentList.pageInfo.currentPage),$("#loadMsg").text("")):$("#loadMsg").text("")}}))}},admin.register["comment-list"]={obj:admin.commentList,init:admin.commentList.init,refresh:admin.commentList.getList};
var plugins={};admin.plugin={plugins:[],add:function(t){t.isInit=!1,t.hash=t.path.replace("/","#")+"/"+t.id,this.plugins.push(t);var a=this._analysePath(t.path);t.index&&a.length<2&&this._addNew(t,a)},setCurByHash:function(t){for(var a=this.plugins,e=0;e<a.length;e++){var n=a[e],i=this._analysePath(n.path),s=!1;(n.index&&window.location.hash.indexOf(n.hash)>-1||n.path.replace("/","#")===window.location.hash||"#main"===window.location.hash&&n.path.indexOf("/main/panel")>-1)&&(s=!0),s&&(n.isInit?plugins[n.id].refresh&&plugins[n.id].refresh(t.page):(n.index?2===i.length&&this._addNew(n,i):this._addToExist(n,i),plugins[n.id].init(t.page),n.isInit=!0))}},_analysePath:function(t){var a=t.split("/");return a.splice(0,1),a},_addNew:function(t,a){if(2===a.length)return t.target=$("#tabPreference li").get(t.index-1),void $("#tabPreference").tabs("add",t);""===a[0]?t.target=$("#tabs>ul>li").get(t.index-1):"article"===a[0]?t.target=$("#tabArticleMgt>li").get(t.index-1):"tools"===a[0]&&(admin.tools.push("#"+t.id),t.target=$("#tabTools>li").get(t.index-1)),t.target||alert("data.index is error!"),$("#tabs").tabs("add",t)},_addToExist:function(t,a){switch(a[0]){case"main":$("#mainPanel"+a[1].charAt(5)).append(t.content);break;case"tools":case"article":2===a.length?$("#tabsPanel_"+a[1]).append(t.content):$("#tabPreferencePanel_"+a[2]).append(t.content);break;case"comment-list":$("#tabsPanel_comment-list").append(t.content)}}};
admin.main={};var lastMain=-1;admin.register.main={obj:admin.main,init:function(){admin.clearTip(),admin.register.main.getLog(),setInterval(admin.register.main.getLog,5e3)},refresh:function(){admin.clearTip()},getLog:()=>{$.ajax({url:Label.servePath+"/admin/logs",cache:!1,timeout:2e3,success:function(t){let e=t.result;for(let t=0;t<e.length;t++){let a=e[t],l=a.id;if(l>lastMain){let t=a.date,e=a.level,n=a.name+":"+a.lineNumber,s=a.message,i='<tbody class="table-oddRow"><tr class="table-hasExpend">';t=t.substring(0,19);let o="";o="WARN"===e?'<td style="width: 40px; vertical-align: top"><span style="color: #f8ba0b; font-weight: bold">'+e+"</span></td>":"INFO"===e?'<td style="width: 40px; vertical-align: top"><span style="color: #00bbff; font-weight: bold">'+e+"</span></td>":"ERROR"===e?'<td style="width: 40px; vertical-align: top"><span style="color: #dd1144" font-weight: bold">'+e+"</span></td>":'<td style="width: 40px; vertical-align: top"><span style="color: #1ea0c3" font-weight: bold">'+e+"</span></td>";let r=i+o+('<td style="width: 135px; vertical-align: top"><span style="color: #4caf50; font-weight: bold">'+t+"</span></td>")+('<td style="vertical-align: top"><span style="word-wrap: break-word; white-space: normal; word-break: break-all"><span style="color: #4caf50; font-weight: bold">'+n+"</span><br>"+s+"</span></td>")+"</tr></tbody>";if(void 0!==a.throwable){r+=a.throwable.class+": "+a.throwable.message+"<br>";for(let t=0;t<a.throwable.stackTrace.length;t++)r+=a.throwable.stackTrace[t]+"<br>"}$("#recentLogs").prepend(r),lastMain=l}}}})}};
admin.about={init:function(){if("\u5185\u6d4b\u7248"===version.split(" ")[1])$("#updateCheck").html('\ud83c\udf4d <font style="color: #3caf36">\u60a8\u6b63\u5728\u4f7f\u7528\u83e0\u841d\u535a\u5ba2\u5185\u6d4b\u7248\u672c\uff0c\u611f\u8c22\u60a8\u5bf9\u5f00\u6e90\u7684\u8d21\u732e\uff01</font>');else{version=version.split(" ")[0],version=version.substr(1),version=version.replace(".","_");var o="bolo_v"+version+"_stable.zip",e="https://ftp.stackoverflow.wiki/bolo/releases/"+o;console.info("\u5f53\u524d\u7248\u672c\u6821\u9a8c\u4e2d\uff1a"+e);var t=version;$.ajax({url:e,type:"head",error:function(){$("#updateCheck").html('<font style="color: #e94c89">\u7248\u672c\u66f4\u65b0\u68c0\u67e5\u5931\u8d25\uff0c\u7f51\u7edc\u9519\u8bef\u6216\u8be5\u7248\u672c\u4e3a\u5185\u6d4b\u7248\u672c\u3002</font>'),$("#loadMsg").text("")},success:function(){console.info("\u5f53\u524d\u7248\u672c\u5728\u6570\u636e\u5e93\u4e2d\u5b58\u5728\uff01\u67e5\u8be2\u65b0\u7248\u672c...");var n=version.indexOf("_"),s=String(version.replace("_",""));console.info("\u7248\u672c\u5206\u9694\u7b26\u4f4d\u7f6e\uff1a"+n+"; \u7248\u672c\u5e8f\u5217\u53f7\uff1a"+s);for(var r=s.length,i=!0;i;){var a=(s=String(Number(s)+1)).length;r!==a&&n++,r=a,console.info("\u88f8\u7248\u672c\u53f7\uff1a"+s);var l=s.substr(0,n)+"_"+s.substr(n);console.info("\u67e5\u8be2\u53f7\uff1a"+l),e="https://ftp.stackoverflow.wiki/bolo/releases/"+(o="bolo_v"+l+"_stable.zip"),console.info("\u67e5\u8be2\u7248\u672c\u4ed3\u5e93\uff1a"+e),$.ajax({url:e,type:"head",async:!1,error:function(){console.info("\u7248\u672c v"+l.replace("_",".")+" \u4e0d\u5b58\u5728\uff0c\u505c\u6b62\u904d\u5386"),i=!1},success:function(){t=l,console.info("\u7248\u672c v"+l.replace("_",".")+" \u5b58\u5728\uff0c\u7ee7\u7eed\u67e5\u8be2\u4e0b\u4e00\u4e2a...")}})}version===t?$("#updateCheck").html('\ud83c\udf4d <font style="color: #3caf36">\u4f60\u6b63\u5728\u4f7f\u7528\u83e0\u841d\u535a\u5ba2\u6700\u65b0\u7248\uff01</font>'):$("#updateCheck").html('<a href="https://github.com/adlered/bolo-solo/releases" target="_blank" style="color: #991a1a">\u83e0\u841d\u535a\u5ba2 v'+t.replace("_",".")+" \u5df2\u63a8\u51fa\uff0c\u8d76\u5feb\u66f4\u65b0\u5427\uff01</a>"),$("#tipMsg").text(""),$("#loadMsg").text("")}})}}},admin.register.about={obj:admin.about,init:admin.about.init,refresh:function(){admin.clearTip()}};
admin.toolBox={locale:"",init:function(){$("#loadMsg").text("")},validate:function(){return!0},update:function(){alert("updated")}},admin.register["tool-box"]={obj:admin.toolBox,init:admin.toolBox.init,refresh:function(){admin.clearTip()}};
var usiteJSON={};admin.usite={locale:"",init:function(){$("#tabUsite").tabs(),$("#loadMsg").text(""),$.ajax({url:Label.servePath+"/admin/usite/get",type:"GET",async:!1,success:function(e){for(var t in usiteJSON=""===e.msg?$.parseJSON('\n{\n    "usiteUserId": "",\n    "usiteWeiBo": "",\n    "usiteQQMusic": "",\n    "usiteStackOverflow": "",\n    "usiteDribbble": "",\n    "usiteGitHub": "",\n    "usiteMedium": "",\n    "usiteTwitter": "",\n    "usiteQQ": "",\n    "usiteLinkedIn": "",\n    "usiteSteam": "",\n    "oId": "",\n    "usiteInstagram": "",\n    "usiteCodePen": "",\n    "usiteWYMusic": "",\n    "usiteWeChat": "",\n    "usiteZhiHu": "",\n    "usiteBehance": "",\n    "usiteTelegram": "",\n    "usiteFacebook": ""\n}\n\n'):$.parseJSON(e.msg))$("#"+t).val(usiteJSON[t])}})},validate:function(){return!0},update:function(){for(var e in noBtnSwal("\u8bf7\u7a0d\u5019",0),usiteJSON){let t=$("#"+e).val();void 0===t&&(t=""),usiteJSON[e]=t}let t=JSON.stringify(usiteJSON);$.ajax({url:Label.servePath+"/admin/usite/set",type:"POST",async:!1,dataType:"json",data:t,success:function(e){200===e.code?noBtnSwal("\u8054\u7cfb\u65b9\u5f0f\u5143\u6570\u636e\u66f4\u65b0\u6210\u529f\uff01",1e3):noBtnSwal("\u8054\u7cfb\u65b9\u5f0f\u5143\u6570\u636e\u66f4\u65b0\u5931\u8d25\uff01\u8bf7\u68c0\u67e5\u5143\u6570\u636e\u5185\u5bb9\u540e\u91cd\u8bd5\u3002",1e3)}})}},admin.register.usite={obj:admin.usite,init:admin.usite.init,refresh:function(){admin.clearTip()}};