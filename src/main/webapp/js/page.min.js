var Page=function(t){this.currentCommentId="",this.tips=t};$.extend(Page.prototype,{share:function(){var t=$(".article__share");if(0!==t.length){var e=t.find(".item__qr"),o=t.data("url"),i=t.data("avatar"),n=encodeURIComponent(t.data("title")+" - "+t.data("blogtitle")),r=encodeURIComponent(o),l={};l.tencent="http://share.v.t.qq.com/index.php?c=share&a=index&title="+n+"&url="+r+"&pic="+i,l.weibo="http://v.t.sina.com.cn/share/share.php?title="+n+"&url="+r+"&pic="+i,l.qqz="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url="+r+"&sharesource=qzone&title="+n+"&pics="+i,l.twitter="https://twitter.com/intent/tweet?status="+n+" "+r,t.find("span").click((function(){var t=$(this).data("type");if(t)return"wechat"===t?(0===e.find("canvas").length?(Util.addScript(Label.staticServePath+"/js/lib/jquery.qrcode.min.js","qrcodeScript"),e.qrcode({width:128,height:128,text:o})):e.slideToggle(),!1):void window.open(l[t],"_blank","top=100,left=200,width=648,height=618")}))}},load:function(){var t=this;$("#comment").click((function(){t.toggleEditor()})).attr("readonly","readonly"),$("#soloEditorCancel").click((function(){t.toggleEditor()})),$("#soloEditorAdd").click((function(){""!=$("#boloUser").val()||loggedIn?swal({title:"\u8c22\u8c22\uff01\u8fd8\u6709\u4e00\u4ef6\u4e8b\u3002",text:"\u5982\u679c\u4f60\u7684\u8bc4\u8bba\u88ab\u56de\u590d\u4e86\uff0c\u4f60\u5e0c\u671b\u6211\u4eec\u53d1\u9001\u90ae\u4ef6\u901a\u77e5\u4f60\u5417\uff1f\u5982\u679c\u613f\u610f\uff0c\u8bf7\u5728\u4e0b\u65b9\u586b\u5199\u4f60\u7684\u90ae\u7bb1\u5730\u5740\uff0c\u53cd\u4e4b\u8bf7\u7559\u7a7a\uff08\u6211\u4eec\u4e0d\u4f1a\u5411\u4f60\u7684\u90ae\u7bb1\u53d1\u9001\u9664\u5fc5\u8981\u901a\u77e5\u5916\u7684\u4efb\u4f55\u4fe1\u606f\uff09\uff1a",content:{element:"input",attributes:{placeholder:"\u5199\u4e0b\u4f60\u7684\u90ae\u7bb1\uff08\u53ef\u7559\u7a7a\uff09",type:"text"}},buttons:["\u53d6\u6d88","\u597d"]}).then(e=>{email=e,null!==email&&(reg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,reg.test(email)||""===email?($.cookie("my_email",email,{expires:7,path:"/"}),t.submitComment()):swal({title:"",text:"\u8bc4\u8bba\u63a8\u9001\u5931\u8d25: \u975e\u6cd5\u90ae\u7bb1\u683c\u5f0f",icon:"error",button:"\u597d"}))}):swal({title:"",text:"\u8bf7\u5148\u586b\u5199\u6635\u79f0!",icon:"warning",button:"\u597d"})}))},toggleEditor:function(t,e){var o=$("#soloEditor");if(0!==o.length){if(!$("#soloEditorComment").hasClass("vditor")){Util.addScript("https://file.fishpi.cn/vditor/3.8.13/dist/index.min.js","vditorScript");var i=["emoji","headings","bold","italic","strike","link","|","list","ordered-list","check","outdent","indent","quote","line","code","inline-code","table","insert-before","insert-after","|","undo","redo","edit-mode","both","preview","|","fullscreen","devtools","help"],n=!0;$(window).width()<768&&(i=["emoji","link","upload","insert-after","edit-mode","preview","fullscreen"],n=!1),window.vditor=new Vditor("soloEditorComment",{placeholder:this.tips.commentContentCannotEmptyLabel,height:180,tab:"\t",esc:function(){$("#soloEditorCancel").click()},ctrlEnter:function(){$("#soloEditorAdd").click()},preview:{delay:500,mode:"editor",url:Label.servePath+"/console/markdown/2html",hljs:{enable:!Label.luteAvailable,style:Label.hljsStyle},parse:function(t){"none"!==t.style.display&&Util.parseLanguage()}},counter:500,resize:{enable:n,position:"top"},lang:Label.langLabel,toolbar:i,after:()=>{vditor.focus()}})}"-300px"===o.css("bottom")||t?($("#soloEditorError").text(""),$(window).width()<768?o.css({top:"0",bottom:"auto",opacity:1}):o.css({bottom:"0",top:"auto",opacity:1}),this.currentCommentId=t,$("#soloEditorReplyTarget").text(e?"@"+e:""),"undefined"!=typeof vditor&&vditor.vditor.wysiwyg&&vditor.focus()):o.css({bottom:"-300px",top:"auto",opacity:0})}else location.href=Label.servePath+"/start"},loadRandomArticles:function(t){var e=this.tips.randomArticles1Label;$.ajax({url:Label.servePath+"/articles/random",type:"POST",success:function(o,i){var n=o.randomArticles;if(n&&0!==n.length){for(var r="",l=0;l<n.length;l++){var a=n[l],s=a.articleTitle;r+="<li><a rel='nofollow' title='"+s+"' href='"+Label.servePath+a.articlePermalink+"'>"+s+"</a></li>"}var c=(t||"<h4>"+e+"</h4>")+"<ul>"+r+"</ul>";$("#randomArticles").append(c)}else $("#randomArticles").remove()}})},loadRelevantArticles:function(t,e){$.ajax({url:Label.servePath+"/article/id/"+t+"/relevant/articles",type:"GET",success:function(t,o){var i=t.relevantArticles;if(i&&0!==i.length){for(var n="",r=0;r<i.length;r++){var l=i[r],a=l.articleTitle;n+="<li><a rel='nofollow' title='"+a+"' href='"+Label.servePath+l.articlePermalink+"'>"+a+"</a></li>"}var s=e+"<ul>"+n+"</ul>";$("#relevantArticles").append(s)}else $("#relevantArticles").remove()},error:function(){$("#relevantArticles").remove()}})},submitComment:function(){var t=this,e=this.tips;if(vditor.getValue().length>1&&vditor.getValue().length<500){$("#soloEditorAdd").attr("disabled","disabled");var o={oId:e.oId,commentContent:vditor.getValue(),boloUser:$("#boloUser").val(),boloSite:$("#boloSite").val(),email:$.cookie("my_email"),URI:window.location.href};this.currentCommentId&&(o.commentOriginalCommentId=this.currentCommentId),$.ajax({type:"POST",url:Label.servePath+"/article/comments",cache:!1,contentType:"application/json",data:JSON.stringify(o),success:function(e){if($("#soloEditorAdd").removeAttr("disabled"),!e.sc)return $("#soloEditorError").html(e.msg),void swal({title:"",text:"\u8bc4\u8bba\u63a8\u9001\u5931\u8d25: "+e.msg,icon:"error",button:"\u597d"});t.toggleEditor(),vditor.setValue(""),swal({title:"",text:"\u8bc4\u8bba\u5df2\u63a8\u9001!",icon:"success",button:"\u597d"}),t.addCommentAjax(e.cmtTpl)}})}else $("#soloEditorError").text(t.tips.commentContentCannotEmptyLabel),swal({title:"",text:"\u8bc4\u8bba\u63a8\u9001\u5931\u8d25: "+t.tips.commentContentCannotEmptyLabel,icon:"error",button:"\u597d"})},addReplyForm:function(t,e){this.currentCommentId=t,this.toggleEditor(t,e)},hideComment:function(t){$("#commentRef"+t).hide()},showComment:function(t,e,o,i){var n=parseInt($(t).position().top);if(i&&(n=parseInt($(t).parents(i).position().top)),$("#commentRef"+e).length>0)$("#commentRef"+e).show().css("top",n+o+"px");else{var r=$("#"+e).clone();r.addClass("comment-body-ref").attr("id","commentRef"+e),r.find("#replyForm").remove(),$("#comments").append(r),$("#commentRef"+e).css("top",n+o+"px")}},addCommentAjax:function(t){$("#comments").children().length>0?$($("#comments").children()[0]).before(t):$("#comments").html(t),Util.parseMarkdown(),Util.parseLanguage(),window.location.hash="#comments"}});